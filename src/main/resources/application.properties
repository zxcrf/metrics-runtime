# Quarkus Application Configuration
# 升级到 Quarkus 3.12.3 + JDK 21 虚拟线程最佳实践

# Application Info
quarkus.application.name=dataos-metrics-runtime
quarkus.http.port=8080
quarkus.http.host=0.0.0.0

# Virtual Threads (JDK 21 虚拟线程优化)
quarkus.thread-pool.core-threads=0

# Native Image Optimization
quarkus.native.additional-build-args=-J-Xmx8G,-H:MaxHeapSize=2G,-march=native
quarkus.native.enable-https-url-handler=true
quarkus.native.monitoring=heapdump

# Dev Profile Configuration
quarkus.datasource.metadb.db-kind=${DATAOS_METRICS_METADB_TYPE:mysql}
quarkus.datasource.metadb.jdbc.url=${DATAOS_METRICS_METADB_JDBC_URL:jdbc:mysql://127.0.0.1:3306/kpi_2025?useSSL=false&allowPublicKeyRetrieval=true}
quarkus.datasource.metadb.username=${DATAOS_METRICS_METADB_USERNAME:root}
quarkus.datasource.metadb.password=${DATAOS_METRICS_METADB_PASSWORD:root}
quarkus.datasource.metadb.jdbc.max-size=${DATAOS_METRICS_METADB_MAX_SIZE:20}

#  连接池优化
%prod.quarkus.datasource.metadb.jdbc.additional-jdbc-properties.preparedStatementCacheSize=500
%prod.quarkus.datasource.metadb.jdbc.additional-jdbc-properties.preparedStatementCacheSqlLimit=2048
%prod.quarkus.datasource.metadb.jdbc.additional-jdbc-properties.socketTimeout=60

# SQLite DataSource Configuration
quarkus.datasource.sqlite.db-kind=other
quarkus.datasource.sqlite.jdbc.driver=org.sqlite.JDBC
quarkus.datasource.sqlite.jdbc.url=jdbc:sqlite::memory:
quarkus.datasource.sqlite.jdbc.max-size=${SQLITE_POOL_SIZE:20}

# SQLite Optimization Properties (极致性能优化)
quarkus.datasource.sqlite.jdbc.additional-jdbc-properties.journal_mode=OFF
quarkus.datasource.sqlite.jdbc.additional-jdbc-properties.synchronous=OFF
quarkus.datasource.sqlite.jdbc.additional-jdbc-properties.locking_mode=EXCLUSIVE
quarkus.datasource.sqlite.jdbc.additional-jdbc-properties.temp_store=memory
quarkus.datasource.sqlite.jdbc.additional-jdbc-properties.cache_size=400000
quarkus.datasource.sqlite.jdbc.additional-jdbc-properties.page_size=4096
quarkus.datasource.sqlite.jdbc.additional-jdbc-properties.mmap_size=0
quarkus.datasource.sqlite.jdbc.additional-jdbc-properties.auto_vacuum=NONE
quarkus.datasource.sqlite.jdbc.additional-jdbc-properties.foreign_keys=ON

# MinIO Configuration
minio.endpoint=${MINIO_ENDPOINT:http://10.19.28.145:19090}
minio.access-key=${MINIO_ACCESS_KEY:modo}
minio.secret-key=${MINIO_SECRET_KEY:Modo@123}
minio.bucket.metrics=${MINIO_BUCKET:metrics-runtime}
minio.secure=false

# Redis Configuration
quarkus.redis.hosts=redis://${REDIS_HOST:127.0.0.1}:${REDIS_PORT:6379}
quarkus.redis.password=${REDIS_PASSWORD:}

# KPI查询缓存TTL（分钟），默认30分钟
kpi.cache.ttl.minutes=${KPI_CACHE_TTL_MINUTES:1}

# Metrics & Monitoring
#quarkus.micrometer.export.prometheus.enabled=true
#quarkus.micrometer.binder.vertx.enabled=true

# Logging Configuration
#quarkus.log.console.json=true
quarkus.log.console.json.enabled=false


# KPI Data Storage Mode
# compDimMode: 按维度分表 (默认)
# distributedMode: 按指标+时间分表
dataos-metrics.runtime.kpi-data-storage-mode=${KPI_STORAGE_MODE:compDimMode}
