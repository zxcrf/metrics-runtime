# Quarkus Application Configuration
# 升级到 Quarkus 3.12.3 + JDK 21 虚拟线程最佳实践

# Application Info
quarkus.application.name=dataos-metrics-runtime
quarkus.http.port=8080
quarkus.http.host=0.0.0.0

# Virtual Threads (JDK 21 虚拟线程优化)
quarkus.virtual-threads.enabled=true

# Native Image Optimization
quarkus.native.additional-build-args=-J-Xmx8G,-march=native
quarkus.native.enable-https-url-handler=true
quarkus.native.monitoring=heapdump

# Dev Profile Configuration
quarkus.datasource.metadb.db-kind=${DATAOS_METRICS_METADB_TYPE:mysql}
quarkus.datasource.metadb.jdbc.url=${DATAOS_METRICS_METADB_JDBC_URL:jdbc:mysql://127.0.0.1:3306/kpi_2025?useSSL=FALSE&characterEncoding=utf-8&allowPublicKeyRetrieval=true&allowMultiQueries=true}
#quarkus.datasource.metadb.jdbc.url=${DATAOS_METRICS_METADB_JDBC_URL:jdbc:mysql://10.19.29.157:3306/dataos_metrics_recode?serverTimezone=GMT%2B8&useSSL=FALSE&characterEncoding=utf-8&allowPublicKeyRetrieval=true&allowMultiQueries=true}
quarkus.datasource.metadb.username=${DATAOS_METRICS_METADB_USERNAME:root}
quarkus.datasource.metadb.password=${DATAOS_METRICS_METADB_PASSWORD:root}
#quarkus.datasource.metadb.password=${DATAOS_METRICS_METADB_PASSWORD:Pass_w0rd}
quarkus.datasource.metadb.jdbc.max-size=${DATAOS_METRICS_METADB_MAX_SIZE:20}

#  连接池优化
%prod.quarkus.datasource.metadb.jdbc.additional-jdbc-properties.preparedStatementCacheSize=500
%prod.quarkus.datasource.metadb.jdbc.additional-jdbc-properties.preparedStatementCacheSqlLimit=2048
%prod.quarkus.datasource.metadb.jdbc.additional-jdbc-properties.socketTimeout=60


quarkus.datasource.sqlite.db-kind=other
quarkus.datasource.sqlite.jdbc.driver=org.sqlite.JDBC
quarkus.datasource.sqlite.jdbc.url=jdbc:sqlite::memory:
quarkus.datasource.sqlite.jdbc.initial-size=10
quarkus.datasource.sqlite.jdbc.min-size=10
quarkus.datasource.sqlite.jdbc.max-size=50
quarkus.datasource.sqlite.jdbc.idle-removal-interval=1H
quarkus.datasource.sqlite.jdbc.max-lifetime=2H
quarkus.datasource.sqlite.jdbc.validation-query-sql=SELECT 1

# MinIO Configuration
minio.endpoint=${MINIO_ENDPOINT:http://127.0.0.1:9000}
minio.access-key=${MINIO_ACCESS_KEY:minioadmin}
minio.secret-key=${MINIO_SECRET_KEY:minioadmin}
minio.bucket.metrics=${MINIO_BUCKET:metrics-runtime}
minio.secure=false

# Redis Configuration
quarkus.redis.hosts=redis://${REDIS_HOST:127.0.0.1}:${REDIS_PORT:6379}
quarkus.redis.password=${REDIS_PASSWORD:}

# KPI查询缓存TTL（分钟），默认30分钟
kpi.cache.ttl.minutes=${KPI_CACHE_TTL_MINUTES:1}

quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
# 确保路径是 /q/metrics (默认值，但显式写出来更保险)
#quarkus.micrometer.export.prometheus.path=metrics

# 如果你使用了 vertx 监控，也可以开启
quarkus.micrometer.binder.vertx.enabled=true
# Logging Configuration
quarkus.log.console.json.enabled=false

# 存算引擎配置
metrics.engine.type=${DATAOS_METRICS_ENGINE:SQLite}
# 第三方驱动加载配置
metrics.driver.plugin.dir=${DATAOS_METRICS_DRIVER_PLUGIN:plugin}
# SQLite引擎配置
metrics.sqlite.storage.dir=${DATAOS_METRICS_SQLITE_STORAGE_DIR:/tmp/cache}
